---
title: "data_cleanup_final_project"
author: "Carine Hajjar and Johannes Lang"
date: "10/31/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(googlesheets4)
library(janitor)
library(stats)
library(fs)
library(readxl)
library(infer)
library(pracma)
```


```{r}
dir_create("raw-data")


skirty <- read_excel("raw-data/skrt.xlsx")

skirty

y <- skirty%>%clean_names()%>%
  rename(gender_r = gender_2, 
         class_r = class_3, 
         extra_r = what_extracurriculars_are_you_most_involved_with_on_campus, 
         concentration_r = what_area_does_your_concentration_fall_into, 
         athlete_r = are_you_a_student_athlete, 
         international_r = are_you_an_international_student, 
         race_r = what_is_your_racial_ethnic_background, 
         urban_r = did_you_grow_up_in_a_rural_or_urban_area, 
         firstgen_r = do_you_identify_as_a_first_generation_student, 
         legacy_r = what_is_your_legacy_status, 
         religion_r = what_is_your_religious_background, 
         political_r = what_are_your_political_views, 
         
         gender_p1 = gender_14, 
         class_p1 = class_15, 
         extra_p1 = what_extracurriculars_are_they_most_involved_with_on_campus_16, 
         concentration_p1 = what_area_does_their_concentration_fall_into_17, 
         athlete_p1 = are_they_a_student_athlete_18, 
         international_p1 = are_they_an_international_student_19, 
         race_p1 = what_is_their_racial_ethnic_background_20, 
         urban_p1 = did_they_grow_up_in_a_rural_or_urban_area_21, 
         firstgen_p1 = do_they_identify_as_a_first_generation_student_22, 
         legacy_p1 = what_is_their_legacy_status_23, 
         religion_p1 = what_is_their_religious_background_24, 
         political_p1 = what_are_their_political_views_25, 
         
         gender_p2 = gender_26, 
         class_p2 = class_27, 
         extra_p2 = what_extracurriculars_are_they_most_involved_with_on_campus_28, 
         concentration_p2 = what_area_does_their_concentration_fall_into_29, 
         athlete_p2 = are_they_a_student_athlete_30, 
         international_p2 = are_they_an_international_student_31, 
         race_p2 = what_is_their_racial_ethnic_background_32, 
         urban_p2 = did_they_grow_up_in_a_rural_or_urban_area_33, 
         firstgen_p2 = do_they_identify_as_a_first_generation_student_34, 
         legacy_p2 = what_is_their_legacy_status_35, 
         religion_p2 = what_is_their_religious_background_36, 
         political_p2 = what_are_their_political_views_37, 
         
         
         gender_p3 = gender_38, 
         class_p3 = class_39, 
         extra_p3 = what_extracurriculars_are_they_most_involved_with_on_campus_40, 
         concentration_p3 = what_area_does_their_concentration_fall_into_41, 
         athlete_p3 = are_they_a_student_athlete_42, 
         international_p3 = are_they_an_international_student_43, 
         race_p3 = what_is_their_racial_ethnic_background_44, 
         urban_p3 = did_they_grow_up_in_a_rural_or_urban_area_45, 
         firstgen_p3 = do_they_identify_as_a_first_generation_student_46, 
         legacy_p3 = what_is_their_legacy_status_47, 
         religion_p3 = what_is_their_religious_background_48, 
         political_p3 = what_are_their_political_views_49, 
         
         gender_p4 = gender_50, 
         class_p4 = class_51, 
         extra_p4 = what_extracurriculars_are_they_most_involved_with_on_campus_52, 
         concentration_p4 = what_area_does_they_concentration_fall_into, 
         athlete_p4 = are_they_a_student_athlete_54, 
         international_p4 = are_they_an_international_student_55, 
         race_p4 = what_is_their_racial_ethnic_background_56, 
         urban_p4 = did_they_grow_up_in_a_rural_or_urban_area_57, 
         firstgen_p4 = do_they_identify_as_a_first_generation_student_58, 
         legacy_p4 = what_is_their_legacy_status_59, 
         religion_p4 = what_is_their_religious_background_60, 
         political_p4 = what_are_their_political_views_61)



m <- y%>%
  select(-s) %>%
  drop_na()%>%
  mutate(n_same_race= NA)

for (i in 1:67) {

respondent_race<-m$race_r[i]

count=0

if(respondent_race==m$race_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_race==m$race_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_race==m$race_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_race==m$race_p4[i])
{count<-count+1}else{
count<-count}

m$n_same_race[i]<-count}
```


```{r}
m<-
  m%>%
  mutate(n_same_religion= NA)

for (i in 1:67) {

respondent_religion<- m$religion_r[i]

count=0

if(respondent_religion==m$religion_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_religion==m$religion_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_religion==m$religion_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_religion==m$religion_p4[i])
{count<-count+1}else{
count<-count}

m$n_same_religion[i]<-count}

```

```{r}
m<-
  m%>%
  mutate(n_same_concentration= NA)

for (i in 1:67) {

respondent_concentration<-m$concentration_r[i]

count=0

if(respondent_concentration==m$concentration_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_concentration==m$concentration_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_concentration==m$concentration_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_concentration==m$concentration_p4[i])
{count<-count+1}else{
count<-count}

m$n_same_concentration[i]<-count}
```



```{r}
m<-
  m%>%
  mutate(n_same_athlete= NA)

for (i in 1:67) {

respondent_athlete<-m$athlete_r[i]

count=0

if(respondent_athlete==m$athlete_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_athlete==m$athlete_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_athlete==m$athlete_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_athlete==m$athlete_p4[i])
{count<-count+1}else{
count<-count}

m$n_same_athlete[i]<-count}
```

```{r}
m<-
  m%>%
  mutate(n_same_international= NA)

for (i in 1:67) {

respondent_international<-m$international_r[i]

count=0

if(respondent_international==m$international_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_international==m$international_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_international==m$international_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_international==m$international_p4[i])
{count<-count+1}else{
count<-count}

m$n_same_international[i]<-count}
```

```{r}
m<-
  m%>%
  mutate(n_same_firstgen= NA)

for (i in 1:67) {

respondent_firstgen<-m$firstgen_r[i]

count=0

if(respondent_firstgen==m$firstgen_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_firstgen==m$firstgen_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_firstgen==m$firstgen_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_firstgen==m$firstgen_p4[i])
{count<-count+1}else{
count<-count}

m$n_same_firstgen[i]<-count}
```

```{r}
m<-
  m%>%
  mutate(n_same_legacy= NA)

for (i in 1:67) {

respondent_legacy<-m$legacy_r[i]

count=0

if(respondent_legacy==m$legacy_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_legacy==m$legacy_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_legacy==m$legacy_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_legacy==m$legacy_p4[i])
{count<-count+1}else{
count<-count}

m$n_same_legacy[i]<-count}
```

```{r}
friend_groups<-
  m%>%
  select(n_same_race, n_same_religion, n_same_concentration, n_same_athlete, n_same_international, n_same_firstgen, n_same_legacy)

```

```{r, some preliminary data visualization}
white_observed_histogram <- m%>%filter(race_r=="White")%>%
  ggplot(aes(x=n_same_race))+
  geom_histogram(binwidth=1)

write_rds(white_observed_histogram, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/o_white.rds")

black_observed_histogram <- m%>%filter(race_r=="Black or African American")%>%
  ggplot(aes(x=n_same_race))+
  geom_histogram(binwidth=1)

write_rds(black_observed_histogram, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/o_black.rds")

asian_observed_histogram <- m%>%filter(race_r=="Asian")%>%
  ggplot(aes(x=n_same_race))+
  geom_histogram(binwidth=1)

write_rds(asian_observed_histogram, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/o_asian.rds")

hispanic_observed_histogram <- m%>%filter(race_r=="Hispanic or Latino")%>%
  ggplot(aes(x=n_same_race))+
  geom_histogram(binwidth=1)

write_rds(hispanic_observed_histogram, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/o_hispanic.rds")



m %>%
  ggplot(aes(x=race_r, y = n_same_race, color =race_r)) +
  geom_violin() +
  stat_summary(fun.y = mean, geom = "point") +
  geom_jitter(shape = 16, color = "black", size = .5)

m %>%
  ggplot(aes(x=religion_r, y = n_same_religion, color =religion_r)) +
  geom_violin() +
  stat_summary(fun.y = mean, geom = "point") +
  geom_jitter(shape = 16, color = "black", size = .5)


```

```{r, permutation test}
m_random_race<-
    
    tibble(replicate = 1:10000)%>%
  
    mutate(race_r = sample(c("White","Black or African American","Asian","Hispanic or Latino","Two or more races"), size=10000, replace = TRUE, prob=c(0.513, 0.1116, 0.228, .093, 0.00)))%>%
  
  mutate(race_p1 = sample(c("White","Black or African American","Asian","Hispanic or Latino","Two or more races"), size=10000, replace = TRUE, prob=c(0.513, 0.1116, 0.228, .093, 0.00)))%>%
  
  mutate(race_p2 = sample(c("White","Black or African American","Asian","Hispanic or Latino","Two or more races"), size=10000, replace = TRUE, prob=c(0.513, 0.1116, 0.228, .093, 0.00)))%>%
  
  mutate(race_p3 = sample(c("White","Black or African American","Asian","Hispanic or Latino","Two or more races"), size=10000, replace = TRUE, prob=c(0.513, 0.1116, 0.228, .093, 0.00)))%>%
  
  mutate(race_p4 = sample(c("White","Black or African American","Asian","Hispanic or Latino","Two or more races"), size=10000, replace = TRUE, prob=c(0.513, 0.1116, 0.228, .093, 0.00)))%>%
  
  mutate(n_same_race= NA)

for (i in 1:10000) {

respondent_race<-m_random_race$race_r[i]

count=0

if(respondent_race==m_random_race$race_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_race==m_random_race$race_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_race==m_random_race$race_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_race==m_random_race$race_p4[i])
{count<-count+1}else{
count<-count}

m_random_race$n_same_race[i]<-count}
```

```{r}
white_replications <- m_random_race %>%
   filter(race_r=="White")%>%
  select(n_same_race)%>%
  rep_sample_n(size = 33, replace = TRUE, reps = 10000) %>% 
  group_by(replicate) %>% 
  summarize(mean_same_race = mean(n_same_race))


mean_observed_white <- as.numeric(m%>%
  filter(race_r=="White")%>%
  summarize(mean=mean(n_same_race)))

white_permutation_plot<- white_replications %>%
  ggplot(aes(x=mean_same_race))+
  geom_density()+
  geom_vline(xintercept=mean_observed_white)

write_rds(white_permutation_plot, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/p_white.rds")


#now to see how likely it is to get the same same_race value or smaller, we can see how many times it happened throught the 1000 replications
  

white_replications %>%
  filter(mean_same_race <= mean_observed_white) %>%
  nrow() / 10000
  


#?sample
#mutate(which_bowl = sample(c("Bowl 1", "Bowl 2"), size=10000, replace = TRUE,prob=c(0.1,0.9)))
#z<- tibble(replicate = 1:10000)%>%
 # mutate(flip = sample(c(0,0.25,0.5,0.75,1), size=10000, replace = TRUE, prob=c(0.25, 0.05, 0.4, #0.05, 0.25))) %>%
  
    #mutate(coin=rbinom(n=10000,size=33,prob=flip))
```

```{r}
#z<- tibble(replicate = 1:33)%>%
 
# mutate(flip = sample(c("White","Nonwhite"), size=33, replace = TRUE, prob=c(0.6,0.4))) %>%
  
 #   mutate(coin=rbinom(n=10000,size=33,prob = 0.6))


```

```{r}
asian_replications <- m_random_race%>%
  filter(race_r=="Asian")%>%
  select(n_same_race)%>%
  rep_sample_n(size = 18, replace = TRUE, reps = 10000) %>% 
  group_by(replicate) %>% 
  summarize(mean_same_race = mean(n_same_race))

mean_observed_asian <- as.numeric(m%>%
  filter(race_r=="Asian")%>%
  summarize(mean=mean(n_same_race)))

asian_permutation_plot<-asian_replications %>%
  ggplot(aes(x=mean_same_race))+
  geom_density()+
  geom_vline(xintercept=as.numeric(mean_observed_asian))

write_rds(asian_permutation_plot, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/p_asian.rds")
             
asian_replications %>%
  filter(mean_same_race >= mean_observed_asian) %>%
  nrow() / 10000
```

```{r}
black_replications <- m_random_race%>%
  filter(race_r=="Black or African American")%>%
  select(n_same_race)%>%
  rep_sample_n(size = 11, replace = TRUE, reps = 10000) %>% 
  group_by(replicate) %>% 
  summarize(mean_same_race = mean(n_same_race))

mean_observed_black <- as.numeric(m%>%
  filter(race_r=="Black or African American")%>%
  summarize(mean=mean(n_same_race)))

black_permutation_plot <- black_replications %>%
  ggplot(aes(x=mean_same_race))+
  geom_density()+
  geom_vline(xintercept=mean_observed_black)

write_rds(black_permutation_plot, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/p_black.rds")

black_replications %>%
  filter(mean_same_race >= mean_observed_black) %>%
  nrow() / 10000
```

```{r}

hispanic_replications <-m_random_race%>%
  filter(race_r=="Hispanic or Latino")%>%
  select(n_same_race)%>%
  rep_sample_n(size = 7, replace = TRUE, reps = 10000) %>% 
  group_by(replicate) %>% 
  summarize(mean_same_race = mean(n_same_race))

mean_observed_hispanic <- as.numeric(m%>%
  filter(race_r=="Hispanic or Latino")%>%
  summarize(mean=mean(n_same_race)))

hispanic_permutation_plot <- hispanic_replications %>%
  ggplot(aes(x=mean_same_race))+
  geom_histogram()+
  geom_vline(xintercept=mean_observed_hispanic)

write_rds(hispanic_permutation_plot, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/p_hispanic.rds")

hispanic_replications %>%
  filter(mean_same_race >= mean_observed_hispanic) %>%
  nrow() / 10000

  
```



rename(gender_r = gender_6, 
         class_r = class_7, 
         extra_r = what_extracurriculars_are_you_most_involved_with_on_campus, 
         concentration_r = what_area_does_your_concentration_fall_into, 
         athlete_r = are_you_a_student_athlete, 
         international_r = are_you_an_international_student, 
         race_r = what_is_your_racial_ethnic_background, 
         urban_r = did_you_grow_up_in_a_rural_or_urban_area, 
         firstgen_r = do_you_identify_as_a_first_generation_student, 
         legacy_r = what_is_your_legacy_status, 
         religion_r = what_is_your_religious_background, 
         political_r = what_are_your_political_views, 
         
         gender_p1 = gender_18, 
         class_p1 = class_19, 
         extra_p1 = what_extracurriculars_are_you_most_involved_with_on_campus_20, 
         concentration_p1 = what_area_does_your_concentration_fall_into_21, 
         athlete_p1 = are_you_a_student_athlete_22, 
         international_p1 = are_you_an_international_student_23, 
         race_p1 = what_is_your_racial_ethnic_background_24, 
         urban_p1 = did_you_grow_up_in_a_rural_or_urban_area_25, 
         firstgen_p1 = do_you_identify_as_a_first_generation_student_26, 
         legacy_p1 = what_is_your_legacy_status_27, 
         religion_p1 = what_is_your_religious_background_28, 
         political_p1 = what_are_your_political_views_29, 
         
         gender_p2 = gender_30, 
         class_p2 = class_31, 
         extra_p2 = what_extracurriculars_are_you_most_involved_with_on_campus_32, 
         concentration_p2 = what_area_does_your_concentration_fall_into_33, 
         athlete_p2 = are_you_a_student_athlete_34, 
         international_p2 = are_you_an_international_student_35, 
         race_p2 = what_is_your_racial_ethnic_background_36, 
         urban_p2 = did_you_grow_up_in_a_rural_or_urban_area_37, 
         firstgen_p2 = do_you_identify_as_a_first_generation_student_38, 
         legacy_p2 = what_is_your_legacy_status_39, 
         religion_p2 = what_is_your_religious_background_40, 
         political_p2 = what_are_your_political_views_41, 
         
         
         gender_p3 = gender_42, 
         class_p3 = class_43, 
         extra_p3 = what_extracurriculars_are_you_most_involved_with_on_campus_44, 
         concentration_p3 = what_area_does_your_concentration_fall_into_45, 
         athlete_p3 = are_you_a_student_athlete_46, 
         international_p3 = are_you_an_international_student_47, 
         race_p3 = what_is_your_racial_ethnic_background_48, 
         urban_p3 = did_you_grow_up_in_a_rural_or_urban_area_49, 
         firstgen_p3 = do_you_identify_as_a_first_generation_student_50, 
         legacy_p3 = what_is_your_legacy_status_51, 
         religion_p3 = what_is_your_religious_background_52, 
         political_p3 = what_are_your_political_views_53, 
         
         gender_p4 = gender_54, 
         class_p4 = class_55, 
         extra_p4 = what_extracurriculars_are_you_most_involved_with_on_campus_56, 
         concentration_p4 = what_area_does_your_concentration_fall_into_57, 
         athlete_p4 = are_you_a_student_athlete_58, 
         international_p4 = are_you_an_international_student_59, 
         race_p4 = what_is_your_racial_ethnic_background_60, 
         urban_p4 = did_you_grow_up_in_a_rural_or_urban_area_61, 
         firstgen_p4 = do_you_identify_as_a_first_generation_student_62, 
         legacy_p4 = what_is_your_legacy_status_63, 
         religion_p4 = what_is_your_religious_background_64, 
         political_p4 = what_are_your_political_views_65)

## preceptor
respondant George and four different rows for friends
the column for race 
then column for religion....

put race on same row

group by respondant 

block them in group of 5 