---
title: "Religion"
author: "Diego Arias"
date: "11/29/2019"
output: html_document
---

m %>%
group_by(religion_r) %>%
count()

```{r, religion permutation test}
# We ran a permutation below to compare to the data collected above. This permutation is based on the overall religion makeup of Harvard-- NOT the religion makeup of just friend groups. We will create a random sample with the proportions reported by Harvard and compare the outcome to the racial makeup of friend groups to see if there is self-segregation:

m_random_religion<-
    
    tibble(replicate = 1:10000)%>%
  
    mutate(religion_r = sample(c("Christian","Jewish","	Muslim","Agnostic or Atheist", "Hindu", "Other"), size=10000, replace = TRUE, prob=c(0.352, 0.065, 0.031, .389, 0.028, .13))) %>%
  
  mutate(religion_p1 = sample(c("Christian","Jewish","	Muslim","Agnostic or Atheist", "Hindu", "Other"), size=10000, replace = TRUE, prob=c(0.352, 0.065, 0.031, .389, 0.028, .13))) %>%
  
  mutate(religion_p2 = sample(c("Christian","Jewish","	Muslim","Agnostic or Atheist", "Hindu", "Other"), size=10000, replace = TRUE, prob=c(0.352, 0.065, 0.031, .389, 0.028, .13))) %>%
  
  mutate(religion_p3 = sample(c("Christian","Jewish","	Muslim","Agnostic or Atheist", "Hindu", "Other"), size=10000, replace = TRUE, prob=c(0.352, 0.065, 0.031, .389, 0.028, .13))) %>%
  
  mutate(religion_p4 = sample(c("Christian","Jewish","	Muslim","Agnostic or Atheist", "Hindu", "Other"), size=10000, replace = TRUE, prob=c(0.352, 0.065, 0.031, .389, 0.028, .13))) %>%
  
  mutate(n_same_religion= NA)

# We repeat the same for loop as we did in the beginning with our collected data, but with the sample we generated with the for loop above:

for (i in 1:10000) {

respondent_religion<-m_random_religion$religion_r[i]

count=0

if(respondent_religion==m_random_religion$religion_p1[i])
{count<-count+1}else{
count<-count}

if(respondent_religion==m_random_religion$religion_p2[i])
{count<-count+1}else{
count<-count}

if(respondent_religion==m_random_religion$religion_p3[i])
{count<-count+1}else{
count<-count}

if(respondent_religion==m_random_religion$religion_p4[i])
{count<-count+1}else{
count<-count}

m_random_religion$n_same_religion[i]<-count}
```

```{r}
asian_replications <- m_random_race%>%
  filter(race_r=="Asian")%>%
  select(n_same_race)%>%
  rep_sample_n(size = 18, replace = TRUE, reps = 10000) %>% 
  group_by(replicate) %>% 
  summarize(mean_same_race = mean(n_same_race))

mean_observed_asian <- as.numeric(m%>%
  filter(race_r=="Asian")%>%
  summarize(mean=mean(n_same_race)))

asian_permutation_plot<-asian_replications %>%
  ggplot(aes(x=mean_same_race))+
  geom_density()+
  geom_vline(xintercept=mean_observed_asian, color = "blue") + 
  labs(title = "Distribution of Mean same race values under null hypothesis", subtitle = "Our observed value, shown in blue, is larger than we would expect under random friend assignment", x = "Mean Number of Same Race Friends per Replication")


write_rds(asian_permutation_plot, "~/Desktop/GOV_1005/final_project_data_cleanup/rough-draft/p_asian.rds")
             
asian_replications %>%
  filter(mean_same_race >= mean_observed_asian) %>%
  nrow() / 10000
```


